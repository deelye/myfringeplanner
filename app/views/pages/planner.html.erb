<!-- Hide form if start date and end date have values -->
<div class="body-container">

  <div class="planner-search-bar">
    <form>
      <select name="day" id="day" class="input-field">
        <% @collection.each do |day| %>
          <option value="<%= day %>"><%= day %></option>
        <% end %>
      </select>
      <button class="button" type="submit">Go</button>
    </form>
  </div>

  <h1 class="planner-header">FRINGE <%= Time.now.year %></h1>

  <div class="planner-date"><h3><%= @dayname %></h3></div>

  <div class="container-planner">

    <div class="planner">
      <div class="planner-times">
        <p>10:00</p>
        <p>11:00</p>
        <p>12:00</p>
        <p>13:00</p>
        <p>14:00</p>
        <p>15:00</p>
        <p>16:00</p>
        <p>17:00</p>
        <p>18:00</p>
        <p>19:00</p>
        <p>20:00</p>
        <p>21:00</p>
        <p>22:00</p>
        <p>23:00</p>
      </div>

      <div class="day-calendar">
        <% @planners.each do |planner| %>
          <%= render "planner", planner: planner %>
        <% end %>
      </div>

      <div class="planner-times">
        <p>10:00</p>
        <p>11:00</p>
        <p>12:00</p>
        <p>13:00</p>
        <p>14:00</p>
        <p>15:00</p>
        <p>16:00</p>
        <p>17:00</p>
        <p>18:00</p>
        <p>19:00</p>
        <p>20:00</p>
        <p>21:00</p>
        <p>22:00</p>
        <p>23:00</p>
      </div>
    </div>

    <div class="planner-shortlist">
      <% @performances.each do |performance| %>
        <%= link_to performance_planners_path(performance ,@planner, day: params[:day]), method: :post do  %>
          <div class="w250">
            <p><%= performance.show.title %></p>
            <p><%= performance.start.strftime('%H:%M') %></p>
          </div>
        <% end %>
      <% end %>


      <div class="planner-cards">
        <% @performances.each do |performance| %>
          <div class="card <%= performance.show.colour_class %>">
            <div class="card-star-n-image">
              <% if current_user&.following?(performance.show) %>
                <%= link_to unfollow_show_path(performance.show) do  %>
                  <i class="fa fa-star star-yellow" aria-hidden="true"></i>
                <% end %>
              <% else %>
                <%= link_to follow_show_path(performance.show) do  %>
                  <i class="fa fa-star star-white" aria-hidden="true"></i>
                <% end %>
              <% end %>
              <%= image_tag(performance.show.original_image, :alt => "Flyer image for show") %>
            </div>
            <div class="card-info">
              <h6><%= truncate(performance.show.title, length: 45) %></h6>
              <p><%= performance.show.genre %></p>
              <div class="d-flex">

                <% dates = ["Aug "] %>
                <% performances = performance.show.performances %>
                <% performances.each_with_index do |performance, index| %>
                  <% if index == 0 %>
                    <% dates << performances.first.start.strftime("%e").to_i %>
                  <% elsif performances[index - 1].start.strftime("%e").to_i + 1  == performance.start.strftime("%e").to_i %>
                    <% if performance == performances[-1] %>
                      <% dates << "-" %>
                      <% dates << performance.start.strftime("%e").to_i %>
                    <% end %>
                  <% elsif performances[index - 1].start.strftime("%e").to_i == performance.start.strftime("%e").to_i%>
                  <% else %>
                    <% dates << "-" %>
                    <% dates << performances[index - 1].start.strftime("%e").to_i %>
                    <% dates << ", " %>
                    <% dates << performance.start.strftime("%e").to_i %>
                  <% end %>
                <% end %>

                <p><i class="fas fa-clock" aria-hidden="true"></i> <%= performances.first.start.strftime("%H:%M") %></p>
                <p><i class="fa fa-calendar card-dates" aria-hidden="true"></i> <%= truncate(dates.join, length: 35) %></p>
              </div>
              <div class="d-flex justify-content-between">
                <p><%= truncate(performance.show.venue.name, length: 50) %></p>
                <p>Â£<%= performances.last.price %></p>
              </div>
            </div>
            <%= link_to show_path(performance.show) do %>
              <div class="hid-link"></div>
            <% end %>
          </div>

        <% end %>
      </div>


    </div>

  </div>
</div>
