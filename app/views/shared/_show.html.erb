<div class="card">
  <!-- Make a button, if following, a click will cause gem to stop following and visa versa. -->
  <!-- Delete shorlist model as a part of the if/else statement -->
  <div class="card-star-n-image">
    <% if current_user&.following?(show) %>
      <%= link_to unfollow_show_path(show) do  %>
        <i class="fa fa-star star-yellow" aria-hidden="true"></i>
      <% end %>
    <% else %>
      <%= link_to follow_show_path(show) do  %>
        <i class="fa fa-star star-white" aria-hidden="true"></i>
      <% end %>
    <% end %>
    <%= image_tag(show.original_image, :alt => "Flyer image for show") %>
  </div>
  <div class="card-info">
    <h6><%= truncate(show.title, length: 45) %></h6>
    <p><%= show.genre %></p>
    <div class="d-flex">

      <% dates = [] %>
      <% performances = show.performances %>
      <% show.performances.each_with_index do |performance, index| %>
        <% if index == 0 %>
          <% dates << performances.first.start.strftime("%b")  %>
          <% dates << " " %>
          <% dates << performances.first.start.strftime("%e").to_i %>
        <% elsif performances[index - 1].start.strftime("%e").to_i + 1 == performance.start.strftime("%e").to_i %>
        <% elsif performances[index - 1].start.strftime("%e").to_i >= performance.start.strftime("%e").to_i %>
          <% dates << performance.start.strftime("%b") %>
          <% dates << " " %>
          <% dates << performance.start.strftime("%e") %>
        <% elsif dates[-2] == "-" %>
          <% dates << ", "%>
          <% dates << performance.start.strftime("%e").to_i %>
        <% else %>
          <% dates << "-" %>
          <% dates << performance.start.strftime("%e").to_i %>
        <% end %>
      <% end %>

      <p><i class="fas fa-clock" aria-hidden="true"></i> <%= performances.first.start.strftime("%H:%M") %></p>
      <p><i class="fa fa-calendar card-dates" aria-hidden="true"></i> <%= dates.join %></p>
    </div>
    <div class="d-flex justify-content-between">
      <p><%= truncate(show.venue.name, length: 27) %></p>
      <p>Â£<%= performances.last.price %></p>
    </div>
  </div>
</div>

<script style="text/javascript">
  function follow () {
    if (current_user.following?(show)) {
      console.log()
      element.classList.remove("star-yellow");
      current_user.follow(show);
    } else {
      element.classList.add("star-yellow");
      current_user.stop_following(show);
    }
  }
  const element = document.getElementById("star")
  element.addEventListener("click", follow);
</script>
